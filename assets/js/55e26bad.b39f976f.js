"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[937],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(a),d=r,h=m["".concat(p,".").concat(d)]||m[d]||c[d]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3025:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],l={slug:"/page",sidebar_position:3},p="Page",s={unversionedId:"page",id:"page",title:"Page",description:"Overview",source:"@site/../docs/page.md",sourceDirName:".",slug:"/page",permalink:"/zio-notion/page",draft:!1,editUrl:"https://github.com/univalence/zio-notion/edit/master/docs/../docs/page.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{slug:"/page",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Database",permalink:"/zio-notion/database"},next:{title:"User",permalink:"/zio-notion/user"}},u={},c=[{value:"Overview",id:"overview",level:2},{value:"Retrieve a page",id:"retrieve-a-page",level:2},{value:"Deal with properties",id:"deal-with-properties",level:2},{value:"Using your own non-primitive types",id:"using-your-own-non-primitive-types",level:3},{value:"Using a different name from Notion",id:"using-a-different-name-from-notion",level:3},{value:"Update a page",id:"update-a-page",level:2},{value:"Create a page",id:"create-a-page",level:2}],m={toc:c};function d(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"page"},"Page"),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"You will deal with ",(0,o.kt)("inlineCode",{parentName:"p"},"Page")," when handling database query results, retrieving a page or as a result of a page you just\ncreated or updated."),(0,o.kt)("p",null,"A ",(0,o.kt)("inlineCode",{parentName:"p"},"Page")," contains the metadata of a Notion page. We tend to follow the Notion api, and they don't provide the content\nof the page. Instead, you have to deal with block instead."),(0,o.kt)("p",null,"For more information, you can check the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.notion.com/reference/page"},"Notion documentation"),"."),(0,o.kt)("h2",{id:"retrieve-a-page"},"Retrieve a page"),(0,o.kt)("p",null,"The easiest way to retrieve a page is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'val page: ZIO[Notion, NotionError, Page] = Notion.retrievePage("page-id")\n')),(0,o.kt)("p",null,"No exhaustively, the page will contain its title, its properties and when it is created."),(0,o.kt)("p",null,"For more information, you can check the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.notion.com/reference/retrieve-a-page"},"notion documentation"),"."),(0,o.kt)("h2",{id:"deal-with-properties"},"Deal with properties"),(0,o.kt)("p",null,"It can be troublesome to deal with page's properties. Indeed, the properties is a map composed by properties that can\ntheoretically be of any kind."),(0,o.kt)("p",null,"As an example, if you want to retrieve a number you will first have to :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ensure that the property exist in the database"),(0,o.kt)("li",{parentName:"ul"},"ensure that the property is indeed a number property"),(0,o.kt)("li",{parentName:"ul"},"ensure that the property is fulfilled with data")),(0,o.kt)("p",null,"You will easily have to write something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'val maybeProperty: Option[Property] = page.properties.get("number")\n\nmaybeProperty.map {\n  case Some(property) =>\n    property match {\n      case number: Property.Number => number.number match {\n        case Some(value) => // \ud83c\udf89\ud83c\udf89\ud83c\udf89\n        case None => // the property "name" exists, it is a number but the row has no data in it\n      }\n      case _ => // the property "name" exists but it is not a number\n    }\n  case None => // the property "name" does not exist\n} \n')),(0,o.kt)("p",null,"That's why you can use the page function ",(0,o.kt)("inlineCode",{parentName:"p"},"propertiesAs[A]")," to convert your properties into a defined case class.\nUnder the hood, it uses Magnolia to automatically derive the case class."),(0,o.kt)("p",null,"If we take the same example, you can now write something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"case class Properties(number: Double)\n\nval propertiesOrError = page.propertiesAs[Properties]\n\npropertiesOrError.map(_.number)\n")),(0,o.kt)("p",null,"It will return a ",(0,o.kt)("inlineCode",{parentName:"p"},"Validation[ParsingError, A]"),", this data structure is provided by\n",(0,o.kt)("a",{parentName:"p",href:"https://zio.github.io/zio-prelude/docs/functionaldatatypes/validation"},"zio-prelude"),"."),(0,o.kt)("p",null,"This way of dealing with properties has several interesting features:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You can deal with optional value"),(0,o.kt)("li",{parentName:"ul"},"You can deal with list of values (Multiselect, People, etc.)"),(0,o.kt)("li",{parentName:"ul"},"You can create encoder for your own enumeration (Select)")),(0,o.kt)("h3",{id:"using-your-own-non-primitive-types"},"Using your own non-primitive types"),(0,o.kt)("p",null,"If you need your case class to use non-primitive types you can add an implicit ",(0,o.kt)("inlineCode",{parentName:"p"},"PropertyConverter")," such as the\nfollowing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import zio.notion.Converter.required\n\nfinal case class Properties(url: Url)\nfinal case class Url(uri: String)\n\nimplicit val urlPropertyConverter: PropertyConverter[Url] = {\ncase Property.Files(_, files) =>\n  required(files.headOption).flatMap {\n    case Link.File(_, file) => Validation.succeed(Url(file.url))\n    case Link.External(_, external) => Validation.succeed(Url(external.url))\n  }\ncase _  => Validation.fail(NotParsableError("Url"))\n}\n\nval propertiesOrError = page.propertiesAs[Properties]\n')),(0,o.kt)("h3",{id:"using-a-different-name-from-notion"},"Using a different name from Notion"),(0,o.kt)("p",null,"The automatic derivation works by using the case class parameter name as the Notion property name. However, sometimes\nit is not appropriate."),(0,o.kt)("p",null,"Imagine the following table:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Price (in $)"),(0,o.kt)("th",{parentName:"tr",align:null},"Date of the shipping"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"purchase 1"),(0,o.kt)("td",{parentName:"tr",align:null},"1$"),(0,o.kt)("td",{parentName:"tr",align:null},"02/02/2022")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"purchase 2"),(0,o.kt)("td",{parentName:"tr",align:null},"40$"),(0,o.kt)("td",{parentName:"tr",align:null},"01/02/2022")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"purchase 3"),(0,o.kt)("td",{parentName:"tr",align:null},"20$"),(0,o.kt)("td",{parentName:"tr",align:null},"03/02/2022")))),(0,o.kt)("p",null,"For each page, if you want to retrieve the properties using automatic derivation, you will have to write something\nlike :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"import java.time.LocalDate\n\nfinal case class Properties(\n  Name: String,\n  `Price (in $)`: Double,\n  `Date of the shipping`: LocalDate\n)\n")),(0,o.kt)("p",null,"Let's be honest, it is not practical. You still can enforce camelCase convention to your Notion users but is not\nconvenient too since Notion is meant to be human-readable."),(0,o.kt)("p",null,"Luckily, you can annotate your parameters :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import java.time.LocalDate\n\nfinal case class Properties(\n  @NotionColumn("Name") name: String,\n  @NotionColumn("Price (in $)") price: Double,\n  @NotionColumn("Date of the shipping") shippingDate: LocalDate\n)\n')),(0,o.kt)("h2",{id:"update-a-page"},"Update a page"),(0,o.kt)("p",null,"Notion allows you to update:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The properties content of the page (including its title)"),(0,o.kt)("li",{parentName:"ul"},"The icon of the page"),(0,o.kt)("li",{parentName:"ul"},"The cover of the page"),(0,o.kt)("li",{parentName:"ul"},"Whether you want to archive the page or not")),(0,o.kt)("p",null,"For more information, you can check the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.notion.com/reference/patch-page"},"notion documentation"),"."),(0,o.kt)("p",null,"Strictly speaking, you have to provide a list of operations describing the list of changes from the current page to the\nexpected one."),(0,o.kt)("p",null,"There is two types of operations :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Stateless operations are operations that does not require the current state of the page to generate a patch. As an\nexample, ",(0,o.kt)("inlineCode",{parentName:"li"},"removeIcon")," is a stateless operation because we don't need to explicitly know if the page already has an\nicon or not."),(0,o.kt)("li",{parentName:"ul"},"Stateful operations are operations that does require the current state of the page. The only current stateful\noperation is ",(0,o.kt)("inlineCode",{parentName:"li"},"UpdateProperty"),". It indeed requires the current page property to update it.")),(0,o.kt)("p",null,"We explicitly differentiate the operations because stateless operations does not require a page to work. It means that\nwe don't have to retrieve the page first to update it. That is why the ",(0,o.kt)("strong",{parentName:"p"},"Notion")," interface provides several\nupdate methods :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"def updatePage(pageId: String, operations: StatelessOperations): IO[NotionError, Page]\ndef updatePage(page: Page, operations: Operations): IO[NotionError, Page]\ndef updatePage(pageId: String, operation: Operation.Stateless): IO[NotionError, Page]\ndef updatePage(page: Page, operation: Operation): IO[NotionError, Page]\n")),(0,o.kt)("p",null,"We provide several kind of operations that can compose multiple operations:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import zio.notion.dsl._ // We advise you to import the dsl\n\nval operations = $"col1".asCheckbox.patch.check ++ removeIcon\n')),(0,o.kt)("p",null,"Here is a non-exhaustive list of operation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'val operation = archive                        // Archive the page (Stateless)\nval operation = unarchive                      // Unarchive the page (Stateless)\nval operation = removeIcon                     // Remove the current icon of the page (Stateless)\nval operation = removeCover                    // Remove the current cover of the page (Stateless)\nval operation = setIcon(newIcon)               // Set a new icon to the page (Stateless)\nval operation = setCover(newCover)             // Set a new cover to the page (Stateless)\nval operation = removeProperty("name")         // Remove the property "name" of the page (Stateless)\nval operation = $"col1".asCheckbox.patch.check // Check the col1 checkbox property (Stateless)\nval operation = $"col1".asNumber.patch.ceil    // Apply a transformation to the col1 number property (Stateful)\n')),(0,o.kt)("p",null,"We advise you to check autocompletion for ",(0,o.kt)("inlineCode",{parentName:"p"},'$"col1".as'),", we provide operations for all notion types."),(0,o.kt)("p",null,"You also can create your own, as an example, if I want to multiply a number by itself:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'val operation = $"col1".asNumber.patch.update(n => n * n) // It is an update (Stateful)\n')),(0,o.kt)("h2",{id:"create-a-page"},"Create a page"),(0,o.kt)("p",null,"You can also create a new page by providing the parent page in both a page and a database."))}d.isMDXComponent=!0}}]);